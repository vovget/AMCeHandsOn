## RAMLドキュメントを使用したAPIの定義とテスト

ここでは、モバイル・アプリから呼び出すことのできるカスタムAPIの設計情報を登録します。AMCeでは、APIの設計情報をRAML（RESTful API Modeling Language）で記述します。APIの設計は、AMCeのサービス・コンソールが提供するAPIデザイナを使用して、一から定義することも可能ですが、今回は事前に作成されたRAMLドキュメントを使用します。

**Step-1** サービス・コンソールの左上にあるハンバーガー・アイコンをクリックして画面左のメニューを開き、「アプリケーション」をクリックします。

![画面左のメニューから「アプリケーション」をクリック](images/2.15.png)

**Step-2** 「アプリケーション」ページで「API」をクリックします。。

![「アプリケーション」ページで「API」をクリック](images/2.16.png)

**Step-3** 「API」ページが表示されます。「新規API」ボタンをクリックします。

![【カスタムAPIがまだ一つも定義されていない場合】「API」ページで「新規API」ボタンをクリック](images/2.17.png)

![【カスタムAPIがすでに定義されている場合】「API」ページで「新規API」ボタンをクリック](images/2.18.png)

**Step-4** 「新規API」ダイアログ・ボックスがポップアップします。「RAMLドキュメントをアップロード」というリンクをクリックします。

![「新規API」ダイアログ・ボックスの「RAMLドキュメントをアップロード」をクリック](images/2.19.png)

**Step-5** アップロードするファイルを選択するウィンドウが表示されるので、C:\HOL\AMCeディレクトリのFIF_IncidentReport.ramlを選択します。「新規API」ダイアログ・ボックスに「FIF_IncidentReport.raml: アップロードおよび検証されました」というメッセージが表示されることを確認します。

![FIF_IncidentReport.ramlをアップロードした直後の「新規API」ダイアログ・ボックス](images/2.20.png)

**Step-6** 「新規API」ダイアログ・ボックスの「API表示名」と「API名」には、それぞれ初期値が設定されているので、下記の表のように変更します。

**「新規API」ダイアログ・ボックスの値を編集**

| 入力項目 | 入力する値                                                         |
| :------- | :----------------------------------------------------------- |
| API表示名     | FIF_IncidentReport_<xx><br />（<xx>はAMCeインスタンス内で一意となる文字列） |
| API名     | FIF_IncidentReport_<xx><br />（「API表示名」と同じ値を指定） |
| 簡単な説明     | （APIを説明する任意の文）             |

![「新規API」ダイアログ・ボックスで「API表示名」、「API名」、「簡単な説明」を編集](images/2.21.png)

編集が終わったら、「作成」ボタンをクリックします。

**Step-7** APIが作成されると、APIデザイナの「一般」ページが表示されます。

![APIデザイナの「一般」ページ](images/2.22.png)

**Step-8** APIデザイナの「セキュリティ」ページを開きます。認証されていないユーザーからのリクエストを許可するために、「ログインが必要です」のスイッチをオフにします。

![APIデザイナの「セキュリティ」ページで「ログインが必要です」スイッチをオフ](images/2.23.png)

**Step-9** アップロードしたRAMLドキュメントの定義内容を確認するために、APIデザイナの「エンドポイント」タブ・ページを開きます。RAMLドキュメントに定義されたリソースが一覧できます。

![APIデザイナの「エンドポイント」ページ](images/2.24.png)

**Step-10** 「/inicidents」リソースの右側には、２つのアイコン ― 青色の「G（GETメソッド）」と緑色の「P（POSTメソッド）」が表示されています。これら２つのアイコンは、「/incidents」リソースがGETリクエストとPOSTリクエストに対応していることを表しています。「G（GETメソッド）」アイコンをクリックします。

![APIデザイナの「エンドポイント」ページ － 「Incidents」リソース](images/2.25.png)

**Step-11** 「/incidents」リソースにGETリクエストを送信するために指定可能なパラメータを確認できます。「contact」、「technician」の２つのクエリー・パラメータを指定できることがわかります。

![「/incidents」リソースのGETリクエストに指定するパラメータ](images/2.26.png)

**Step-12** 「レスポンス」リンクをクリックすると、HTTPステータス・コードごとにどのようなレスポンスが返ってくるかを確認できます。「/incidents」リソースのGETリクエストの場合、ステータス200が返ってきた場合は、「例」タブ・ページに記述されているようなJSONが返ってくることを表しています。

![「/incidents」リソースのGETリクエストのレスポンスの例](images/2.27.png)

**Step-13** 登録したカスタムAPIをテストしてみます。APIデザイナの画面右上の「保存」ボタンをクリックして保存してから、「テスト」ボタンをクリックします。

![APIデザイナの「保存」ボタンと「テスト」ボタンをクリック](images/2.28.png)

**Step-14** 「画面左のリストで「GET /incidents」を選択します。画面を下にスクロールし、「認証」パネルで「モバイル・バックエンド」から「FIF_Technician_<xx>」（このハンズオンの『[モバイル・バックエンドの作成](2.backend-1.md)』で作成したモバイル・バックエンド）を選択し、「認証方式」から「Current User」を選択し、「エンドポイントのテスト」ボタンをクリックします。

![APIのエンドポイントのテスト](images/2.29.png)

このAPIはまだ実装されていませんが、AMCeはAPIが実装されるまでの間、モック・データを返すことができます。モック・データはRAMLドキュメントに記述されたレスポンスの本文の例に基づいて生成されます。

![APIのエンドポイントのテスト － レスポンスのモック・データの表示](images/2.30.png)
